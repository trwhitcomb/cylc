CYLC METASCHEDULER CHANGE LOG, INITIALIZED after version 3.0.3.

Non-trivial changes of relevance to users are listed. All changes are
likely to involve unlisted minor updates and corrections to cylc 
documentation (User Guide, command line help, and GUI help).

Version number X.Y.Z incrementing:
  X - major changes
  Y - significant changes
  Z - minor changes and bug fixes

3.0.4
 + More documentation of error detection in task scripts.
 + 'cylc admin create-cdb' now uses its own test suite.

3.0.5
 + Clarified graph-based control GUI help.

3.1.0
 + Allow use of lockserver in simulation mode.
 + New suite compare/diff functionality added.

3.2.0
 + Big speed up for large suites due to some optimization of the
   scheduling algorithm.
 + Monospaced fonts in GUI output capture windows.

3.3.0
 + Updated the terminal monitor to display held (paused) tasks properly.
 + Entirely eliminated the need for explicit task wrapping:
   - moved 'task started' and 'task succeeded' messages, and automatic
   'task failed' messaging, to the generated task job script.
   - task scripts now only have to call 'task succeeded/failed', and
     only for tasks whose initiating processes detach and exit early.
   - this means the entire task job script is now seen by cylc, not just 
     the (formerly) wrapped command line.
   - task-specific pre-command scripting is no longer needed - instead
     the task command string can contain multiline scripting.
 + New variable $CYLC_SUITE_ENVIRONMENT in the task execution environment
   for use in custom wrappers for tasks with manual completion messaging.
 + Added and documented new example suite to illustrate custom task wrapping.

3.3.1
 + Fixed a typo in writing out the new $CYLC_SUITE_ENVIRONMENT to job
 scripts, which could break new-style custom wrappers for detaching tasks. 

3.3.2
 + Fixed a bug introduced at 3.2.0 that prevented failed tasks from 
   becoming 'unfailed' after retriggering them.

3.3.3
 + Full path configuration for suite state dump and log directories.
 + Fixed recently introduced bug affecting loadleveler job submission: an
   executable statement appeared before the directives in task job scripts.

3.3.4
 + Autogenerated HTML version of the User Guide added.
 + Fixed a bug introduced at 3.2.0 affecting suite warm starts:
   - a misspelled function call in bin/_run caused suite warm starts to fail.
 + Fixed a bug introduced at 3.3.0 affecting detached tasks in simulation mode:
   -  Since eliminating 'cylc wrap' tasks that handle their own
      completion messaging in real mode need automatic completion in sim mode.  
 + Documented local installation of Pyro, Graphviz, and Pygraphviz.
 + Documented how to upgrade to a new version of cylc.

 3.3.5
 + Fix a bug that affected task submission and execution timeouts:
   - if a timeout was set, the hook script was called even if the event
     did occur in time - which should cancel the timeout.
 + More detailed documentation of complete installation by non-root users.

 3.3.6
 + Documentation of graphviz installation without QT.
 + Improved detection of errors in suite.rc graph hours headings.
 + Improved detection of erroneous suite registrations on the command line.
 + Fixed a bug in 'cylc log' command task filtering.
 + At installation, unregister example suites from admin user's private db.
 + Task event hook script argument list changed. Cylc now calls:
     <hook script> EVENT SUITE TASK CTIME MESSAGE
   The new SUITE argument is particularly needed if running multiple suites.
   WARNING: this change will break existing task event hook scripts.
 + Added a task event hook script to 'cylc util' that sends email alerts.

3.3.7
 + Disabled the cylc lockserver by default.
 + Altered environment.sh to work with 'set -u'.
 + Better task error trapping: in addition to trapping processes that
 abort with non-zero exit status (ERR signal) cylc now also registers
 task failure after unexpected exit with normal exit status (EXIT
 signal), process termination by the TERM signal (e.g. by 'kill PID' or
 'llcancel JOBID'), and termination (e.g. by the batch scheduler) due
 to exceeding some system time limit (XCPU signal).

 
3.4.0 (4 August 2011)

  + Fixed bug introduced in 3.3.7: trapping of EXIT signal must be 
  turned off at the end of job scripts for detaching tasks (which
  handle their own completion messaging).

  + Task event hook script argument list changed again. It is now:
     <hook script> EVENT SUITE TASKID MESSAGE
  where TASKID works with both cycling and non-cycling (asynchronous)
  tasks. WARNING: this will break existing task event hook scripts.
  
  + Also, the EVENT argument for job submission failures is now
  "submission_failed" rather than "submit_failed", to be more consistent
  with the associated suite.rc item.

  + Disabled run time graphing by default, in suite.rc [visualization]. 
  It is mainly intended for use in cylc development and debugging.
  WARNING: this breaks existing suite.rc run time graph settings.

  + Initial and final cycles for graph plotting can now be provided in 
  the suite.rc file, and can be overridden on the command line.

  + Initial and final cycle times can now be provided in the suite.rc
  file, and optionally overridden on the command line.

  + Fixed a lockserver bug, introduced in March 2011, that only affected
  owned tasks.

  + Added asynchronous tasks (no cycle time):
    - one-off asynchronous tasks for any non-cycling jobs.
    - repeating asynchronous tasks for processing satellite passes.

  + Made the User Guide accessible from GUI help menus.

3.4.0-a (bug fix release 5 Aug 2011)

  + Fixed a bug affecting detaching tasks in simulation mode only - job
  script EXIT signal trapping was not being cleared before exiting. 
  + Fixed a bug in the FFTask example suite (which is not actually
  referred to in the User Guide yet) - it had not been upgraded for
  compatibility with recent cylc versions.

3.5.0

 + Fixed a bug, introduced in 3.4.0, in the lockserver client program
  for manual lock management.

 + The cylc code base is now a Python library and the environment.sh
 script is no longer needed: you just need the cylc command in $PATH.

 + Task generators: definition of multiple similar tasks all at once.
 Two new examples suites illustrate this new feature.

 3.5.1  bug fix release 15 Aug 2011

  + Fixed a Python indentation error introduced in 3.4.0, which 
  affected the list of valid hours for tasks that appear in multiple 
  suite.rc graph strings (i.e. tasks with different triggers at 
  different cycle times). 

4.0.0-rc1

+ WARNING cylc-4.0 IS NOT ENTIRELY BACKWARD COMPATIBLE with 3.x
due to significant changes to suite.rc structure and item names. 
 Suggested suite upgrade strategy: 
    1/ read this changelog, then
    2/ use 'cylc validate' to see which items are no longer valid ...
    3/ ... then consult the suite.rc reference, and 
    4/ examine the cylc example suites if necessary
Future changes will be more incremental and we will ensure backward
compatibility or provide a clear (possibly automated) upgrade path.

+ UTC Mode: optionally run a suite on UTC time even if the suite
 host's system clock is not in UTC mode.

+ Fixed a suite graph plotting bug: if the graph initial hour was 
 greater than the section hour for single hour graph sections, the
 section would be skipped even if the graph range encompassed the
 section, due to miss-handling of the 24-hour boundary.

+ Fixed a subtle bug in environment variable overriding: if a variable
 was defined twice, the second definition would override the first as
 it should, but it would retain the position (in the list of defined
 variables) of the first.

+ General parenthesized conditional triggers
  - WARNING: This required a change in intercycle dependency notation
    from ROUND to SQUARE brackets (to avoid clashing with parentheses 
    in conditional expressions):
       foo(T-6) becomes foo[T-6]

+ Embedded list-generating Python expressions can now be used to
 generate related dependencies in the graph (e.g. for the internal
 dependencies of an ensemble); and lists of task names or
 list-generating Python expressions in task config section headings,
 to define multiple tasks at once.

+ Configurable command template for at_now, background and loadleveler.
 Some example use cases might be:
  - a user may want to use batch instead of at now.
  - a user may want to use an option of llsubmit.
  - a user may want to use nice with a background submit.

+ Configurable ssh command template.
  - no longer require scp - use stdin to transfer job file.
  - -oBatchMode=yes prevents any hang ups.
  - (but ssh command is bit more complex.)

+ sudo job submission (for other owner on the suite host) removed. Now
use ssh as for remote hosts.

+ New default directory structure.
  - $HOME/cylc-run/$CYLC_SUITE_REG_NAME/{log/suite,log/job,state}

+ Task logs now go to the proper directory tree on remote hosts (and remote 
directories are created on the fly if necessary).

+ Use microseconds since epoch instead of random string for tagging a job task.
   - this allows "ls" to list things in the right order.
   - stdout and stderr files are now named after their task job scripts.

+ Fixed a bug preventing use of :fail triggers with asynchronous tasks.

 + New "suicide" triggers: graph = "A => !B" means B will take itself out of 
 the suite (after spawning, if it is a cycling task) if A succeeds. This can
 be used for automated recovery from task failures using sub-trees of tasks
 that tag along with a model (say) waiting for it to fail, but which
 automatically remove themselves if the model does not fail.

+ MAJOR CHANGE TO SUITE.RC STRUCTURE: 
  * better organization under new top level sections:
  [cylc] - non task-related suite config. 
  [scheduling] - determines when tasks are ready to run
  [runtime] - determines what runs, and how and where, when a task is ready
  * under [runtime] family and task properties are defined by a
  "namespace inheritance hierarchy" that allows common configuration of
  related tasks without repetition. 
WARNING: there are a number of changes associated with this item that
will break existing suite.rc files.

+ Task families are now defined by the runtime namespace hierarchy.
  * when used in the graph, they are suite definition shorthand only
   (no pseudo-task representing the family appears in the task pool). 
  * can be individually expanded or collapsed for graph plotting, and in
   the graph-based suite control GUI.

+ 'command =' config item changed to 'command scripting =' for consistency
  with 'pre-' and 'post-command scripting', and because it has long since
  ceased to be a single command.

+ New command 'cylc get-config' to retrieve any suite configuration data.

+ gcylc entry labels made consistent with command help, and gcylc Help
 buttons now call command help on the fly.

+ MAJOR CHANGE TO SUITE REGISTRATION SYNTAX:
   - changed from GROUP:NAME to an arbitrarily nested path (foo,
     foo.bar, foo.bar.baz, etc.)  Delimiter changed from colon to dot to
     avoid problems with use of suite identity in PATH variables.

+ suite identity variables changed for new registration names:
    CYLC_SUITE_REG_NAME    # foo.bar.baz
    CYLC_SUITE_REG_PATH    # foo/bar/baz
    CYLC_SUITE_DEF_PATH    # suite definition directory
+ task identity variables made consistent with suite identity variables:
    CYLC_TASK_ID
    CYLC_TASK_NAME
    CYLC_TASK_CYCLE_TIME
    CYLC_TASK_NAMESPACE_HIERARCHY  # <-- new

+ 'cylc admin test-suite' now detects failures properly.

+ Updated the User Guide for all the above.

+ suite hold is now implemented by holding all waiting tasks instead of
just not running them - this is more transparent to the user.

+ RUNAHEAD LIMIT:
    - now implemented by putting tasks into a special 'runahead' held
      state, rather than just delaying spawning. This is more
      transparent to the user.
    - now applies if (Ttask-Toldest) >= limit (was '>'). This generally 
    makes the limit shorter by one cycle, but is more intuitive.

+ Default start and stop times, if defined, are now displayed in the 
 GUI start panel (and the same for suite graph plotting).

+ Inlined editing of suite.rc files that use include-files: the 
 temporarily inlined file is now the live file during the editing
 session - i.e. changes take effect, for graphing or running the
 suite etc., whenever the inlined file is saved rather than on
 exiting the edit session.

 4.0.0-rc2 PENDING

+ Bug fix: suite validation output aborted if an error occurred 
during task proxy instantiation.

+ 'cylc validate' now returns exit status 1 if validation fails.

+ restored full syntax highlighting to the User Guide.

+ corrected 'cylc email-alert' command help.


